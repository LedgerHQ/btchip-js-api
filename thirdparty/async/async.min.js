/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 *//*jshint onevar: false, indent:4 *//*global setImmediate: false, setTimeout: false, console: false */(function(){function d(a){var c=!1;return function(){if(c)throw new Error("Callback was already called.");c=!0,a.apply(b,arguments)}}var a={},b,c;b=this,b!=null&&(c=b.async),a.noConflict=function(){return b.async=c,a};var e=Object.prototype.toString,f=Array.isArray||function(a){return e.call(a)==="[object Array]"},g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};typeof process=="undefined"||!process.nextTick?typeof setImmediate=="function"?(a.nextTick=function(a){setImmediate(a)},a.setImmediate=a.nextTick):(a.nextTick=function(a){setTimeout(a,0)},a.setImmediate=a.nextTick):(a.nextTick=process.nextTick,typeof setImmediate!="undefined"?a.setImmediate=function(a){setImmediate(a)}:a.setImmediate=a.nextTick),a.each=function(a,b,c){function f(b){b?(c(b),c=function(){}):(e+=1,e>=a.length&&c())}c=c||function(){};if(!a.length)return c();var e=0;g(a,function(a){b(a,d(f))})},a.forEach=a.each,a.eachSeries=function(a,b,c){c=c||function(){};if(!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},a.forEachSeries=a.eachSeries,a.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},a.forEachLimit=a.eachLimit;var k=function(a){return function(b,c,d){d=d||function(){};if(!b.length||a<=0)return d();var e=0,f=0,g=0;(function h(){if(e>=b.length)return d();while(g<a&&f<b.length)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})})()}},l=function(b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[a.each].concat(c))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[a.eachSeries].concat(c))}},o=function(a,b,c,d){b=h(b,function(a,b){return{index:b,value:a}});if(!d)a(b,function(a,b){c(a.value,function(a){b(a)})});else{var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}};a.map=l(o),a.mapSeries=n(o),a.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};a.reduce=function(b,c,d,e){a.eachSeries(b,function(a,b){d(c,a,function(a,d){c=d,b(a)})},function(a){e(a,c)})},a.inject=a.reduce,a.foldl=a.reduce,a.reduceRight=function(b,c,d,e){var f=h(b,function(a){return a}).reverse();a.reduce(f,c,d,e)},a.foldr=a.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.filter=l(q),a.filterSeries=n(q),a.select=a.filter,a.selectSeries=a.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(a){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.reject=l(r),a.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};a.detect=l(s),a.detectSeries=n(s),a.some=function(b,c,d){a.each(b,function(a,b){c(a,function(a){a&&(d(!0),d=function(){}),b()})},function(a){d(!1)})},a.any=a.some,a.every=function(b,c,d){a.each(b,function(a,b){c(a,function(a){a||(d(!1),d=function(){}),b()})},function(a){d(!0)})},a.all=a.every,a.sortBy=function(b,c,d){a.map(b,function(a,b){c(a,function(c,d){c?b(c):b(null,{value:a,criteria:d})})},function(a,b){if(a)return d(a);var c=function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0};d(null,h(b.sort(c),function(a){return a.value}))})},a.auto=function(b,c){c=c||function(){};var d=j(b),e=d.length;if(!e)return c();var h={},k=[],l=function(a){k.unshift(a)},m=function(a){for(var b=0;b<k.length;b+=1)if(k[b]===a){k.splice(b,1);return}},n=function(){e--,g(k.slice(0),function(a){a()})};l(function(){if(!e){var a=c;c=function(){},a(null,h)}}),g(d,function(d){var e=f(b[d])?b[d]:[b[d]],k=function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]);if(b){var f={};g(j(h),function(a){f[a]=h[a]}),f[d]=e,c(b,f),c=function(){}}else h[d]=e,a.setImmediate(n)},o=e.slice(0,Math.abs(e.length-1))||[],p=function(){return i(o,function(a,b){return a&&h.hasOwnProperty(b)},!0)&&!h.hasOwnProperty(d)};if(p())e[e.length-1](k,h);else{var q=function(){p()&&(m(q),e[e.length-1](k,h))};l(q)}})},a.retry=function(b,c,d){var e=5,f=[];typeof b=="function"&&(d=c,c=b,b=e),b=parseInt(b,10)||e;var g=function(e,g){var h=function(a,b){return function(c){a(function(a,d){c(!a||b,{err:a,result:d})},g)}};while(b)f.push(h(c,!(b-=1)));a.series(f,function(a,b){b=b[b.length-1],(e||d)(b.err,b.result)})};return d?g():g},a.waterfall=function(b,c){c=c||function(){};if(!f(b)){var d=new Error("First argument to waterfall must be an array of functions");return c(d)}if(!b.length)return c();var e=function(b){return function(d){if(d)c.apply(null,arguments),c=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=b.next();g?f.push(e(g)):f.push(c),a.setImmediate(function(){b.apply(null,f)})}}};e(a.iterator(b))()};var t=function(a,b,c){c=c||function(){};if(f(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};a.parallel=function(b,c){t({map:a.map,each:a.each},b,c)},a.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},a.series=function(b,c){c=c||function(){};if(f(b))a.mapSeries(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.eachSeries(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}},a.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},a.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};a.concat=l(u),a.concatSeries=n(u),a.whilst=function(b,c,d){b()?c(function(e){if(e)return d(e);a.whilst(b,c,d)}):d()},a.doWhilst=function(b,c,d){b(function(e){if(e)return d(e);var f=Array.prototype.slice.call(arguments,1);c.apply(null,f)?a.doWhilst(b,c,d):d()})},a.until=function(b,c,d){b()?d():c(function(e){if(e)return d(e);a.until(b,c,d)})},a.doUntil=function(b,c,d){b(function(e){if(e)return d(e);var f=Array.prototype.slice.call(arguments,1);c.apply(null,f)?d():a.doUntil(b,c,d)})},a.queue=function(b,c){function e(b,c,d,e){b.started||(b.started=!0),f(c)||(c=[c]);if(c.length==0)return a.setImmediate(function(){b.drain&&b.drain()});g(c,function(c){var f={data:c,callback:typeof e=="function"?e:null};d?b.tasks.unshift(f):b.tasks.push(f),b.saturated&&b.tasks.length===b.concurrency&&b.saturated(),a.setImmediate(b.process)})}c===undefined&&(c=1);var h=0,i={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){e(i,a,!1,b)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(a,b){e(i,a,!0,b)},process:function(){if(!i.paused&&h<i.concurrency&&i.tasks.length){var a=i.tasks.shift();i.empty&&i.tasks.length===0&&i.empty(),h+=1;var c=function(){h-=1,a.callback&&a.callback.apply(a,arguments),i.drain&&i.tasks.length+h===0&&i.drain(),i.process()},e=d(c);b(a.data,e)}},length:function(){return i.tasks.length},running:function(){return h},idle:function(){return i.tasks.length+h===0},pause:function(){if(i.paused===!0)return;i.paused=!0},resume:function(){if(i.paused===!1)return;i.paused=!1;for(var b=1;b<=i.concurrency;b++)a.setImmediate(i.process)}};return i},a.priorityQueue=function(b,c){function d(a,b){return a.priority-b.priority}function e(a,b,c){var d=-1,e=a.length-1;while(d<e){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function h(b,c,h,i){b.started||(b.started=!0),f(c)||(c=[c]);if(c.length==0)return a.setImmediate(function(){b.drain&&b.drain()});g(c,function(c){var f={data:c,priority:h,callback:typeof i=="function"?i:null};b.tasks.splice(e(b.tasks,f,d)+1,0,f),b.saturated&&b.tasks.length===b.concurrency&&b.saturated(),a.setImmediate(b.process)})}var i=a.queue(b,c);return i.push=function(a,b,c){h(i,a,b,c)},delete i.unshift,i},a.cargo=function(b,c){var d=!1,e=[],i={tasks:e,payload:c,saturated:null,empty:null,drain:null,drained:!0,push:function(b,d){f(b)||(b=[b]),g(b,function(a){e.push({data:a,callback:typeof d=="function"?d:null}),i.drained=!1,i.saturated&&e.length===c&&i.saturated()}),a.setImmediate(i.process)},process:function j(){if(d)return;if(e.length===0){i.drain&&!i.drained&&i.drain(),i.drained=!0;return}var a=typeof c=="number"?e.splice(0,c):e.splice(0,e.length),f=h(a,function(a){return a.data});i.empty&&i.empty(),d=!0,b(f,function(){d=!1;var b=arguments;g(a,function(a){a.callback&&a.callback.apply(null,b)}),j()})},length:function(){return e.length},running:function(){return d}};return i};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};a.log=v("log"),a.dir=v("dir"),a.memoize=function(b,c){var d={},e={};c=c||function(a){return a};var f=function(){var f=Array.prototype.slice.call(arguments),g=f.pop(),h=c.apply(null,f);h in d?a.nextTick(function(){g.apply(null,d[h])}):h in e?e[h].push(g):(e[h]=[g],b.apply(null,f.concat([function(){d[h]=arguments;var a=e[h];delete e[h];for(var b=0,c=a.length;b<c;b++)a[b].apply(null,arguments)}])))};return f.memo=d,f.unmemoized=b,f},a.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},a.times=function(b,c,d){var e=[];for(var f=0;f<b;f++)e.push(f);return a.map(e,c,d)},a.timesSeries=function(b,c,d){var e=[];for(var f=0;f<b;f++)e.push(f);return a.mapSeries(e,c,d)},a.seq=function(){var b=arguments;return function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();a.reduce(b,d,function(a,b,d){b.apply(c,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,b){e.apply(c,[a].concat(b))})}},a.compose=function(){return a.seq.apply(null,Array.prototype.reverse.call(arguments))};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};a.applyEach=l(w),a.applyEachSeries=n(w),a.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},typeof module!="undefined"&&module.exports?module.exports=a:typeof define!="undefined"&&define.amd?define([],function(){return a}):b.async=a})();